services:
  grpc_ws_bridge:
    build: .
    container_name: yellowstone-grpc-ws-bridge
    environment:
      - YELLOWSTONE_HOST=${YELLOWSTONE_HOST-127.0.0.1}
      - YELLOWSTONE_GRPC_PORT=${YELLOWSTONE_GRPC_PORT-10000}
      - YELLOWSTONE_RPC_PORT=${YELLOWSTONE_RPC_PORT-8899}
      - YELLOWSTONE_GRPC_PROTOCOL=${YELLOWSTONE_GRPC_PROTOCOL-http}
      - YELLOWSTONE_RPC_PROTOCOL=${YELLOWSTONE_RPC_PROTOCOL-http}
      - SOLANA_RPC_URL=${SOLANA_RPC_URL-}
      - BLOCK_CACHE_SIZE=${BLOCK_CACHE_SIZE-500}
      - FILTER_TOKEN_BALANCES=${FILTER_TOKEN_BALANCES-false}
      - TOKEN_ACCOUNT_CACHE_MAX_SIZE=${TOKEN_ACCOUNT_CACHE_MAX_SIZE-100000}
      # Optional. Leave empty for self-hosted gRPC endpoints if you don't require auth.
      - YELLOWSTONE_X_TOKEN=${YELLOWSTONE_X_TOKEN-}
      - WS_BIND=0.0.0.0
      - WS_PORT=8787
      - HEALTH_BIND=0.0.0.0
      - HEALTH_PORT=8788
      - SOLANA_HEALTHCHECK_INTERVAL_MS=${SOLANA_HEALTHCHECK_INTERVAL_MS-30000}
      - SOLANA_HEALTHCHECK_TIMEOUT_MS=${SOLANA_HEALTHCHECK_TIMEOUT_MS-5000}
      - SOLANA_HEALTHCHECK_INTERVAL_UNHEALTHY_MS=${SOLANA_HEALTHCHECK_INTERVAL_UNHEALTHY_MS-1000}
      - GRPC_REQUIRE_HEALTHY=${GRPC_REQUIRE_HEALTHY-true}
    ports:
      - '8787:8787'
      - '8788:8788'
    healthcheck:
      test: ['CMD-SHELL', 'curl -fsS http://127.0.0.1:8788/health || exit 1']
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    restart: unless-stopped
